var mobile_version="3.0.0";var init_done=false,home_created=false,LastViewed=[],SugarSessionId="",RowsPerPage=20,IconsLabels=true,tmpIconsLabels=false,CurrentUserId="",ActivitiesCurrentOffset=0,ActivitiesNextOffset=0,ActivitiesPrevOffset=0;var ForceLogin=false,OptDatePicker=!iOS&&(mobile_app||!Modernizr.inputtypes.datetime),tmpOptDatePicker=false,OptUpload=(!mobile_app&&window.File&&window.FileReader&&window.FileList&&typeof btoa==="function"?true:false);var PagesCreated=false,edit_data={},AttachTo="",AttachToLnk="",Pref={};var dbgOption=false,dbgval="";var regFindField=new RegExp("^(.+){(.+)}(.+)$","");var AddFields=["street","postalcode","city","state","country"],ListsPages=["LastViewed","Activities","AllModules","GS"],SearchPages=[],ViewPages=[];var Qpattern=new RegExp('^(.+session":")("|[^"]+)(".+)$',"");var Beans=[],SimpleBeans=[];function QAjax(c,b,a){$.ajax({url:proxy_url,dataType:"json",async:(c!=="login"),data:{method:c,input_type:"JSON",response_type:"JSON",rest_data:b},type:"post",crossdomain:mobile_app,cache:false,error:function(d){a(null)},success:a})}function SugarQuery(e,b,d,c){function a(f){if(f!==null&&f.name==="Invalid Session ID"&&e!=="logout"){if(e!=="login"){if(c===undefined){c=1}else{c++}if(c>6){return}SugarQuery("login",'[{"password":"'+(mobile_app?$.md5(Qpwd):getCookie("SugarP"))+'","user_name":"'+(mobile_app?Quser_name:getCookie("username"))+'"},"",""]',function(g){b=b.replace(Qpattern,"$1")+SugarSessionId+b.replace(Qpattern,"$3");SugarQuery(e,b,d,c+1)},c)}else{d(f)}}else{if(f!==null&&e=="login"&&f.name_value_list!==undefined){getDateTimeFormats(f.name_value_list);SugarSessionId=f.id;CurrentUserId=f.name_value_list.user_id.value}d(f)}}QAjax(e,b,a)}QCRM.get_available_modules=function(g){var d=localStorage.getItem("dis-"+ServerAddress+CurrentUserId);var f=localStorage.getItem("acl-"+ServerAddress+CurrentUserId);function e(h){if(Beans[h]!==undefined){Beans[h].access="none"}}function c(h,i){if(Beans[h]!==undefined){Beans[h].acl=i}}function b(m,o){var k,h=o.length,j=Beans[m].acl;for(k=0;k<o.length;k++){var p=o[k],n=p.action;switch(n){case"edit":j[n]=j[n]&&p.access;break;case"list":case"view":j[n]=p.access;break;case"delete":j.del=j.del&&p.access;break;default:break}}return j}if(d===null||d===""||f===null||f===""){d=[];f=[];if(QCRM.OffLine){g()}else{SugarQuery("get_available_modules",'{"session":"'+SugarSessionId+'"'+(sugar_version>="6.3"?',"filter":'+(sugar_version>="6.5"?'"all"':'"all"'):"")+"}",function(k){if(k&&k.modules){k=k.modules;var h,p,j=k.length,l=[];for(h in QCRM.beans){var i=QCRM.beans[h],o=false;if(typeof k[0]==="string"){if(k.indexOf(i)===-1){l.push(i);e(i)}else{n={edit:true,view:true,list:true,del:true};f.push({module:i,acls:n});c(i,n);break}}else{for(p=0;p<j;p++){var n;if(k[p].module_key===i){o=true;n=b(i,k[p].acls);f.push({module:i,acls:n});c(i,n);break}}if(!o){l.push(i);e(i)}}}localStorage.setItem("dis-"+ServerAddress+CurrentUserId,JSON.stringify(l));localStorage.setItem("acl-"+ServerAddress+CurrentUserId,JSON.stringify(f))}g()})}}else{var a;d=jQuery.parseJSON(d);for(a in d){e(d[a])}f=jQuery.parseJSON(f);for(a in f){c(f[a].module,f[a].acls)}g()}};QCRM.get_entry=function(a,c,b){if(QCRM.OffLine){QCRM.webdb.get_entry(a,c,b)}else{SugarQuery("get_entry",'{"session":"'+SugarSessionId+'","module_name":"'+a+'","id":"'+c+'","select_fields":"","link_name_to_fields_array":""}',b)}};QCRM.get_entry_list=function(d,c,a,f,b,e,g){if(QCRM.OffLine){QCRM.webdb.get_entry_list(d,c,a,f,b,e,g)}else{SugarQuery("get_entry_list",'{"session":"'+SugarSessionId+'","module_name":"'+d+'","query":"'+c+'","order_by":"'+e+'","offset":'+f+',"select_fields":'+a+',"link_name_to_fields_array":"","max_results":'+b+',"deleted":0}',g)}};QCRM.get_S_entry_list=function(d,c,a,f,b,e,g){if(QCRM.OffLine){QCRM.webdb.get_S_entry_list(d,c,a,f,b,e,g)}else{SugarQuery("get_entry_list",'{"session":"'+SugarSessionId+'","module_name":"'+d+'","query":"'+c+'","order_by":"'+e+'","offset":'+f+',"select_fields":"","link_name_to_fields_array":"","max_results":'+b+',"deleted":0}',g)}};QCRM.get_relationships=function(c,d,g,f,b,a,e){if(QCRM.OffLine){QCRM.webdb.get_relationships(c,d,g,f,b,a,e)}else{SugarQuery("get_relationships",'{"session":"'+SugarSessionId+'","module_name":"'+c+'","module_id":"'+g+'","link_field_name":"'+f+'","related_module_query":"'+b+'","related_fields":'+a+',"related_module_link_name_to_fields_array":"","deleted":0}',e)}};QCRM.search_by_module=function(b,e,c,a,d){if(QCRM.OffLine){QCRM.webdb.search_by_module(b,e,c,a,d)}else{SugarQuery("search_by_module",'{"session":"'+SugarSessionId+'","search_string":"'+e+'","modules":["'+b.join('","')+'"],"offset":'+c+',"max_results":'+a+"}",d)}};function CreateExtLink(c,d){var a=mobile_app&&!iOS&&navigator.app;var b=$("<a/>",{href:(a?"#":c),rel:"external",target:"_blank",style:"text-decoration:none;color:#444;"});if(a){b.click(function(){navigator.app.loadUrl(c,{openExternal:true})})}return b}function AddPhonePopup(d){var c=$('<ul id="Phone'+d+'L" data-role="listview" data-inset="true" data-theme="d"/>'),b='<a href="#"'+d+' data-rel="back" data-role="button" data-theme="a" data-icon="delete" data-iconpos="notext" class="ui-btn-right">Close</a>',a=$('<div data-role="popup" data-corner="true" data-shadow="true" data-theme="d" id="Phone'+d+'"/>');a.append(b);a.append(c);$("#"+d).append(a)}function AddMapPopup(d){var c=$('<div id="Map'+d+'D"/>'),b='<a href="#'+d+'DetailsPage" data-rel="back" data-role="button" data-theme="a" data-icon="delete" data-iconpos="notext" class="ui-btn-right">Close</a>',a=$('<div data-role="popup" data-corner="true" data-shadow="true" data-theme="d" id="Map'+d+'"/>');a.append(b);a.append(c);$("#"+d+"DetailsPage").append(a)}function QuickCRMAddDetailsPage(b){if(ViewPages.indexOf(b)!==-1){return}ViewPages=ViewPages.concat(b);var c=b+"DetailsPage",a="#Edit"+b;$("#"+c).live("pagecreate",function(){AddPhonePopup(b+"DetailsPage");if(Beans[b].HasAddress()){AddMapPopup(b)}var e=Beans[b].CustomLinks||Beans[b].Links;for(var i in e){var d=(Beans[b].CustomLinks&&Beans[b].CustomLinks[0]!==undefined)?e[i]:i;if(Beans[b].Links[d]!==undefined){var h=Beans[b].Links[d].module;if(sugar_app_list_strings.moduleList[h]!==undefined&&(Beans[h]===undefined||(Beans[h].Enabled()))){var g='<ul id="'+b+"DetailsPage"+d+'ListUl"  data-role="listview" data-split-theme="c" data-inset="true" />';$("#"+b+"Links").append(g)}}}});$("#"+c).live("pageshow",function(){Beans[b].ViewDetails()});$(a).live("pagecreate",function(){$(a+"CancelTopBtn").text(sugar_app_strings.LBL_CANCEL_BUTTON_LABEL);$(a+"ConfirmTopBtn").text(sugar_app_strings.LBL_SAVE_BUTTON_LABEL);$(a+"CancelBottomBtn").text(sugar_app_strings.LBL_CANCEL_BUTTON_LABEL);$(a+"ConfirmBottomBtn").text(sugar_app_strings.LBL_SAVE_BUTTON_LABEL);$(a+"Title").text(sugar_app_list_strings.moduleListSingular[b])})}function QuickCRMAddListPage(b){if(SearchPages.indexOf(b)!==-1){return}SearchPages=SearchPages.concat(b);ListsPages=ListsPages.concat(b);Beans[b].AddBtn=true;var a=Beans[b];$("#"+b+"ListPage").live("pagecreate",function(){if(a.PhoneFields.length>0||!init_done){AddPhonePopup(b+"ListPage")}});$("#"+b+"ListPage").live("pageshow",function(){a.GetList(a.CurrentOffset)});$("#"+b+"Search").live("pagecreate",function(){$("#"+b+"SearchTitle").text(sugar_app_list_strings.moduleList[b]);$("#"+b+"DivMoreOptions").append("<p>"+RES_UNAVAILABLE+"</p>");if(!iOS){$("#"+b+"Search input[type=checkbox]").live("change",function(c){$("#"+b+"Search input[type=checkbox]").checkboxradio("refresh")})}});$("#"+b+"Search").live("pageshow",function(){LoadMyItems(b)})}function toDBConcatName(b,a){if(db_type==="mysql"){return"CONCAT(IFNULL("+b+",''),' ',"+a+")"}else{return"ISNULL("+b+",'')+' '+"+a}}function cleanup_phone(a){return a.replace("(","").replace(")","").replace(/\s/g,"").replace(/-/g,"").replace(/\./g,"")}function init_labels(d,a){for(var c in a){var b="",e=a[c];if(sugar_mod_fields[d][e]!==undefined&&sugar_mod_fields[d][e].req){b="<em>* </em>"}$('label[for="Edit'+d+"_"+e+'"]').html(b+display_label(d,e))}}function pickRelate(h,b,e,d,c){if(c===undefined){c="Edit"}var g=$("#"+c+h+"_"+e).val();var f=$("#"+(c==="Edit"?"":c)+h+e+"L");$("#"+(c==="Edit"?"":c)+h+"_"+b).val("");if(g.length<1){f.html("");f.listview("refresh")}else{var a=" "+Beans[d].SearchName+" LIKE '%"+g.replace("'","''")+"%'";QCRM.get_entry_list(d,a,Beans[d].ListFieldsToSelect(),0,10,Beans[d].OrderBy,function(o){var k=o.entry_list,j=k.length;f.html("");for(var n=0;n<j;n++){var q=$('<li data-icon="false"/>'),p=$("<a/>",{href:"#"}),m=getFromTemplate(d,k[n].name_value_list,Beans[d].TitleTpl);p.click({id:k[n].id,idf:b,name:m,namef:e,module:h},function(i){$("#"+c+i.data.module+"_"+i.data.idf).val(i.data.id);$("#"+c+i.data.module+"_"+i.data.namef).val(i.data.name.replace(/&#039;/g,"'"));f.html("");f.listview("refresh")});p.append(m);q.append(p);f.append(q)}f.listview("refresh")})}}function onChangeDateEnum(a){var b=$("#"+a+"E").val();if($("#"+a+"E").val()=="between"){$("#"+a+"FromTo").show()}else{$("#"+a+"FromTo").hide()}}function SavedSearchEnum(b){$("#"+b+"SaveAs").val("");$("#"+b+"HSearch").attr("checked",false).checkboxradio("refresh");var k=$("#"+b+"SS");var g=QCRM.SavedSearch;var d=true,i={" ":" --- "};for(var c in g){var h=g[c];if(h&&h.module===b&&h.name&&h.name!==""){d=false;i[h.name]=h.name}}if(d){k.hide()}else{k.html("");var f=create_enum_form(b+"ES",RES_SAVEDSEARCH+" ",i,false,true,"");f.change(function(e,j){onChangeSearch(b)});k.append(f);var a=$("<a/>",{href:"#",click:function(){DelCurrentSavedSearch(b)}});a.text(sugar_app_strings.LBL_DELETE_BUTTON_LABEL);k.append(a);k.show()}}function readSearchValues(c){var a=[],d=c+"DivMoreOptions";var b="Settings"+c+"Search";a.push({field:b,type:"txt",val:$("#"+b).val()});$("#"+d+" [type=checkbox]").each(function(f,e){var g=$("#"+this.id).is(":checked");a.push({field:this.id,type:"chk",val:g})});$("#"+d+" input[type!=checkbox]").each(function(f,e){var h=$("#"+this.id).val();if(this.name!==""&&h!==""&&this.name.substring(0,4)==="Pick"){var g=$("#"+this.id).mobiscroll("getDate");if(g!==null&&e!==""){h=toDBDate(g)}}a.push({field:this.id,type:"txt",val:h})});$("#"+d+" select").each(function(f,e){var g=$("#"+this.id).val();a.push({field:this.id,type:"sel",val:g})});return a}function loadSearchValues(b,a){for(field in a){try{var e=a[field],d=$("#"+e.field);if(e.type==="chk"){d.attr("checked",e.val).checkboxradio("refresh")}else{if(e.val!==""&&d.attr("name")!==undefined&&d.attr("name").substring(0,4)==="Pick"){d.mobiscroll("setDate",fromDBDate(e.val),true)}else{if(e.type==="sel"){d.val(e.val).selectmenu("refresh")}else{d.val(e.val)}}}}catch(c){}}}function onChangeSearch(d){var c=$("#"+d+"ES").val();if(c!==undefined&&c!==" "){var a=QCRM.SavedSearch;for(var b in a){if(b&&c===a[b].name&&d===a[b].module){loadSearchValues(d,a[b].fields);return}}}}function ListSavedSearch(b){var c=QCRM.SavedSearch[b],a=c.module;Beans[a].CurrentSearchFields=c.fields;Beans[a].CurrentOffset=0;$.mobile.changePage("#"+a+"ListPage")}function SaveSavedSearch(){localStorage.setItem(QuickCRMAddress+"SavedSearches",JSON.stringify(QCRM.SavedSearch))}function DelCurrentSavedSearch(d){var c=$("#"+d+"ES").val();if(c!==undefined&&c!==" "&&confirm(sugar_app_strings.NTC_DELETE_CONFIRMATION)){var a=QCRM.SavedSearch;for(var b in a){if(a[b]&&c===a[b].name&&d===a[b].module){QCRM.SavedSearch.splice(b,1);SavedSearchEnum(d);SaveSavedSearch();return}}}}function updateSavedSearch(e,a){var h=$("#"+e+"SaveAs").val();if(h!==""){var b=QCRM.SavedSearch;var d=false;for(var c in b){var f=b[c];if(f.module===e&&h===f.name){d=c;break}}var g=$("#"+e+"HSearch").is(":checked");if(d){QCRM.SavedSearch[d].fields=a;QCRM.SavedSearch[d].home=g}else{QCRM.SavedSearch.push({module:e,name:h,fields:a,home:g})}SaveSavedSearch()}}function get_where(a,m){var d="",h="",j=false,c=QCRM.SavedSearch,k=Beans[a],n=k.table;var b=k.CurrentSearchFields,e=[];for(var g in b){e[b[g].field]={type:b[g].type,val:b[g].val}}j=e[a+"MyItems"].val;if(j){if(d!==""){d+=" and"}d+=" "+n+".assigned_user_id = '"+CurrentUserId+"'"}var i=e["Settings"+a+"Search"].val;if(i!==""){if(d!==""){d+=" and"}d+=" "+k.SearchName+" LIKE '%"+i.replace(/'/g,QCRM.OffLine?"&#039;":"''")+"%'"}if(Pref.FilterOldDate!==""&&Pref.FilterOld.indexOf(a)!==-1){if(d!==""){d+=" and"}d+=" "+n+".date_entered > '"+Pref.FilterOldDate+"'"}return d}function SaveMyItems(b,a){localStorage.setItem(b+"MyItems",(a?1:0))}function LoadMyItems(b){var a=localStorage.getItem(b+"MyItems");if(a==="1"){$("#"+b+"MyItems").attr("checked",true).checkboxradio("refresh")}else{$("#"+b+"MyItems").attr("checked",false).checkboxradio("refresh")}}function AlertPopup(a){$("#Alert"+$(".ui-page-active").attr("id")).html("<p>"+a+"</p>").popup("open")}function hasPhoneValues(g,c){var b=false;var a=Beans[c].PhoneFields;for(var e in a){if(g[a[e]]!==undefined&&g[a[e]].value!==""){b=true;break}}return b}function OpenPhoneList(j,b,a,m,e){$(a+"L li").remove();var g=$(a+"L"),n;if(a==="#PhoneAccountsDetailsPage"){n=Beans.Accounts.CurrentId}g.append($('<li data-theme="a"/>').append("<h3>"+m+"</h3>"));var h=Beans[b].PhoneFields;for(var i in h){var k=h[i];if(j[k]!==undefined&&j[k].value!==""){var c=$("<a/>",{href:"tel:"+cleanup_phone(j[k].value),rel:"external",style:"text-decoration:none;color:#444;",click:function(){$(a).popup("close");if(e){LogCall(b,j.id.value,n)}return true}});c.append(display_label(b,k)+" "+j[k].value);g.append($('<li data-theme="e" data-icon="phone"/>').append(c))}}g.listview("refresh")}function OpenMap(c,b,a){$("#Map"+b+"D").html('<iframe id="Map'+b+'I"+ src="http://maps.google.com/?q='+a+'&t=m&z=13&iwloc=near&output=embed" width="480" height="320" seamless></iframe>');setTimeout('$("#'+c+'").removeClass("ui-btn-active")',100)}function AjaxErr(){$.mobile.changePage("#LoginPage");$("#LoginLoading").html("Login failed. Please check permissions on custom/QuickCRM directory");if(mobile_app){$("#NeedHelpDiv").show()}}function MobileInit(g){function c(){QCRM.get_available_modules(function(){var k="#HomePage";if(g!==undefined){k=g}else{if(init_module!==""&&init_record!==""&&Beans[init_module]!==undefined){Beans[init_module].CurrentId=init_record;k="#"+init_module+"DetailsPage";init_module="";init_record=""}}$("#LoginForm").append(h);AfterLogin(k,(!mobile_app))})}init_done=true;$.mobile.fixedtoolbar.prototype.options.tapToggle=false;if(mobile_app){document.addEventListener("resume",onResume,false);document.addEventListener("pause",onPause,false)}try{if($.mobile.urlHistory.stack[0].pageUrl==="HomePage"){$("#HomePage").trigger("pagecreate")}}catch(d){}var b=new Date();if(!b.isDST()){TimeZoneOffset++}var f;var j=mobile_app?"1":getCookie("RememberMe");var i=mobile_app?Quser_name:getCookie("username"),a=mobile_app?$.md5(Qpwd):getCookie("SugarP");var h='<fieldset data-role="controlgroup" data-mini="true"><input type="checkbox" name="RememberMe" id="RememberMe" class="custom" data-theme="c" /><label for="RememberMe">'+RES_REMEMBER_ME+'</label></fieldset><div style="margin:0 auto; margin-left:auto; margin-right:auto; align:center; text-align:center;"><a id="LoginButton" href="javascript:LoginUser();" data-role="button" data-inline="true" data-mini="true">'+RES_LOGIN_TITLE+"</a></div>";if(QCRM.OffLine){}else{if(j==="1"&&!ForceLogin&&i!==null&&i!==""&&a!==null&&a!==""){var e=false;setTimeout(function(){if(!e){AjaxErr()}},6000);seamlessLogin(function(k){e=true;if(k===null){$("#LoginLoading").html("unexpected error. Please check your permissions and SugarCRM log file")}else{if(k===1||k.name_value_list!==undefined){if(k.name_value_list!==undefined){SugarSessionId=k.id;CurrentUserId=k.name_value_list.user_id.value;localStorage.setItem("SugarId",CurrentUserId)}c()}else{if(mobile_app){if(k!==-1){$("#LoginLoading").html(RES_WRONG_PASWD)}}else{$("#LoginForm").append(h);$("#LoginLoading").hide();$("#LoginForm").show()}}}})}else{$("#LoginForm").append(h);$("#LoginPage").trigger("pagecreate");$("#LoginLoading").hide();$("#LoginForm").show()}}if(typeof QuickCRMInit==="function"){QuickCRMInit()}}function InitLoginPage(){$("#LoginPageMessage").text(RES_LOGIN_MESSAGE);$("#LoginPageTitle").text("QuickCRM"+(mobile_edition==="Pro"?" Pro":""));var a="NS-Team - QuickCRM "+mobile_edition+" - V"+mobile_version;$("#LoginFooter").html(a);$("#HomePageFooter").html(a);if(typeof QuickCRMBeforeLogin=="function"){QuickCRMBeforeLogin()}if(!mobile_app){var b="<em>* </em>";$("#SettingsUsernameLabel").html(b+RES_USERNAME_LABEL);$("#SettingsPasswordLabel").html(b+RES_PASSWORD_LABEL)}var c=getCookie("username");if(c!==null&&c!==""){$("#SettingsUsername").val(c)}}$("#LoginPage").live("pagecreate",InitLoginPage);$("#LoginPage").live("pageshow",function(a,b){if(!init_done){MobileInit()}if(home_created&&mobile_app&&!iOS){$.mobile.changePage("#HomePage")}if(!mobile_app){$("#RememberMe").checkboxradio();$("#LoginButton").button();$("#RememberMe").attr("checked",(getCookie("RememberMe")==="1")).checkboxradio("refresh")}$("#LoginLoading").hide();if(!ForceLogin&&SugarSessionId!==""){return}if(typeof QuickCRMBeforeLogin=="function"){QuickCRMBeforeLogin()}var c=getCookie("username");if(c!==null&&c!==""){$("#SettingsUsername").val(c)}});$("#HomePage").live("pagecreate",function(){if(mobile_edition==="CE"){$("#AboutPro").show()}if(!init_done){MobileInit()}$.mobile.page.prototype.options.backBtnTheme="a";if(typeof HomePageInit==="function"){HomePageInit()}$("#NotifyClear").text(RES_CLEAR);$("#AdminPageLinkLabel").text(RES_OPTIONS);$("#ActivitiesLinkLabel").text(RES_CALENDAR);$("#AllModulesLinkLabel").text(RES_ALLMODULES);$("#LastViewedLinkLabel").text(sugar_app_strings.LBL_LAST_VIEWED);$("#SyncPageLinkLabel").text(RES_SYNC);var a;for(a in ViewPages){var b=ViewPages[a];Beans[b].CreateHook()}});$("#EditOptions").live("pagecreate",function(){initOptionsForm()});$("#EditOptions").live("pageshow",function(){$("#OptRowsPerPage").val(RowsPerPage).slider("refresh");$("#OptIconsLabels").attr("checked",tmpIconsLabels).checkboxradio("refresh");$("#OptHideEmptySubP").attr("checked",Pref.HideEmptySubP).checkboxradio("refresh");for(var a in QCRM.beans){var b=QCRM.beans[a];if(Beans[b].Enabled()){$("#Home"+b).attr("checked",(Pref.Hidden.indexOf(b)===-1)).checkboxradio("refresh")}}$('label[for="GSMyItems"]').text(sugar_app_strings.LBL_CURRENT_USER_FILTER);$("#GSSubmit").text(sugar_app_strings.LBL_SEARCH_BUTTON_LABEL)});$("#ActivitiesListPage").live("pagecreate",function(){if(Beans.Calls.PhoneFields.length>0||Beans.Meetings.PhoneFields.length||!init_done){AddPhonePopup("ActivitiesListPage")}$("#ActivitiesListPageTitle").text(RES_CALENDAR);$('label[for="ActPeriod_missed"]').html(RES_MISSED);$('label[for="ActPeriod_today"]').html(sugar_app_list_strings.date_search.today);$('label[for="ActPeriod_7days"]').html(RES_7DAYS);$('label[for="ActPeriod_30days"]').html(RES_7DAYS.replace("7","30"));$("#ActivitiesListPageSubMenu input:radio").change(function(a,b){GetActivitiesList(ActivitiesCurrentOffset)})});$("#LastViewedListPage").live("pagecreate",function(){$("#LastViewedListPageTitle").text(sugar_app_strings.LBL_LAST_VIEWED)});$("#AllModulesListPage").live("pagecreate",function(){$("#AllModulesListPageTitle").text(RES_ALLMODULES);GetAllModulesList()});$("#ActivitiesListPage").live("pageshow",function(){GetActivitiesList(ActivitiesCurrentOffset)});$("#LastViewedListPage").live("pageshow",function(){GetLastViewedList()});$("#AllModulesListPage").live("pageshow",function(){$("#AllModulesListDiv").listview("refresh")});$("#HomePage").live("pageshow",function(){if(!init_done){MobileInit()}home_created=true;if(SugarSessionId===""&&!QCRM.OffLine){$.mobile.changePage("#LoginPage")}$("#OffLineContainer").hide();if(!iOS){$("#GlobalSearch input[type=checkbox]").live("change",function(a){$("#GlobalSearch input[type=checkbox]").checkboxradio("refresh")})}});function ShowHideToolbarLabels(){var k="",h,d=(IconsLabels?RES_HOME_LABEL:""),f=(IconsLabels?sugar_app_strings.LBL_CREATE_BUTTON_LABEL:k),g=(IconsLabels?sugar_app_strings.LBL_BACK:k),l=(IconsLabels?RES_ALLMODULES:k),e=(IconsLabels?sugar_app_strings.LBL_EDIT_BUTTON:k),o=(IconsLabels?sugar_app_strings.LBL_DELETE_BUTTON_LABEL:k),q=(IconsLabels?sugar_app_strings.LBL_LAST_VIEWED:k),j=(IconsLabels?RES_CALENDAR:k),p=(IconsLabels?sugar_app_strings.LBL_SEARCH_BUTTON_LABEL:k),n=(IconsLabels?sugar_app_strings.LNK_LIST_NEXT:k),a=(IconsLabels?sugar_app_strings.LNK_LIST_PREVIOUS:k);for(h in ListsPages){var m="#"+ListsPages[h];$(m+"ListPageHomeBtn").text(d);$(m+"AllModulesBtn").text(l);$(m+"CalendarBtn").text(j);$(m+"GSBtn").text(p);$(m+"LBackBtn").text(g);$(m+"LastViewedBtn").text(q)}for(h in SearchPages){var c="#"+SearchPages[h];$(c+"SHomeBtn").text(d);$(c+"ListPageSearchBtn").text(p);$(c+"PreviousBtn").text(a);$(c+"SBackBtn").text(g);$(c+"NextBtn").text(n);if(Beans[SearchPages[h]].AddBtn){$(c+"ListPageAddBtn").text(f);$(c+"SAddBtn").text(f)}}for(h in ViewPages){var b="#"+ViewPages[h];$(b+"HomeBtn").text(d);$(b+"SearchBtn").text(IconsLabels?sugar_app_list_strings.moduleList[ViewPages[h]]:k);$(b+"BackBtn").text(g);$(b+"EditBtn").text(e);$(b+"DelBtn").text(o)}}function seamlessLogin(a){SugarQuery("login",'[{"password":"'+(mobile_app?$.md5(Qpwd):getCookie("SugarP"))+'","user_name":"'+(mobile_app?Quser_name:getCookie("username"))+'"},"",""]',function(c){if(c!==null&&mobile_app&&c.name!==undefined){SugarQuery("login",'[{"password":"'+Qpwd+'","user_name":"'+Quser_name+'"},"",""]',function(b){a(b)})}else{a(c)}})}function AfterLogin(l,m){if(!PagesCreated){QCRM.enableBeans(["Accounts","Contacts","Opportunities","Leads","Calls","Meetings","Tasks","Cases","Project","ProjectTask","Notes"])}try{var d=["","on","isnull","before","after","greater_than","less_than","not_equal","last_7_days","last_30_days"];for(var e in d){if(sugar_app_list_strings.date_search[d[e]]!==undefined){delete sugar_app_list_strings.date_search[d[e]]}}sugar_app_list_strings.date_search["="]=" --- ";if(sugar_version<"6.2"){var n=sugar_app_list_strings.date_search.between_dates;sugar_app_list_strings.date_search.between=n;delete sugar_app_list_strings.date_search.between_dates}}catch(c){}SimpleBeans.Users.DefValue=CurrentUserId;for(var p in SimpleBeans){SimpleBeans[p].Load()}for(var e in SearchPages){var a=SearchPages[e];if(sugar_mod_fields[a]===undefined||Beans[a].access==="none"){Beans[a].access="none";$("#Icon"+a).remove()}}if(Beans.Meetings.access==="none"&&Beans.Calls.access==="none"){$("#ActivitiesContainer").remove()}if(sugar_app_list_strings.parent_type_display===undefined){sugar_app_list_strings.parent_type_display=sugar_app_list_strings.moduleList;delete sugar_app_list_strings.parent_type_display.Users}defaultPreferences();updatePreferences(true);if(typeof QuickCRMAfterLogin=="function"){QuickCRMAfterLogin()}for(var h in ViewPages){var o=ViewPages[h],q=Beans[o];var g=q.AllFields();for(var k in g){var b=sugar_mod_fields[o][g[k]];if(b!==undefined&&b.type==="phone"){q.PhoneFields.push(g[k])}}q.ListFields=q.ListFields.concat(q.PhoneFields)}if(l!==""){$.mobile.changePage(l)}$.mobile.hidePageLoadingMsg();if(m){$("#LoginLoading").hide();$("#LoginForm").show()}QCRM.updateBeans()}function onResume(){if(!QCRM.OffLine){seamlessLogin(function(a){if(a&&a.id&&a.name_value_list!==undefined){SugarSessionId=a.id;CurrentUserId=a.name_value_list.user_id.value;localStorage.setItem("SugarId",CurrentUserId);if(Pref.Alerts){CronAlerts()}}})}}function onPause(){if(!QCRM.OffLine){if(Pref.Alerts){StopAlerts()}}}function LoginUser(e,h){$.mobile.showPageLoadingMsg();var i=$("#SettingsUsername").val(),f,d=$("#SettingsPassword").val();if(!e){d=$.md5(d);f=d}var g=false;setTimeout(function(){if(!g){AjaxErr()}},4000);SugarQuery("login",'[{"password":"'+d+'","user_name":"'+i+'"},"",""]',function(b){g=true;if(b){if(b.name!==undefined){$.mobile.hidePageLoadingMsg();e===undefined?LoginUser(true):AlertPopup(RES_WRONG_PASWD)}else{SugarSessionId=b.id;CurrentUserId=b.name_value_list.user_id.value;setCookie("username",$("#SettingsUsername").val(),365);$("#SettingsUsername").val("");$("#SettingsPassword").val("");var a=$("#RememberMe").is(":checked");setCookie("RememberMe",(a?1:0),10);setCookie("SugarP",(f===undefined?d:f),365);localStorage.setItem("SugarId",CurrentUserId);AfterLogin(h===undefined?"#HomePage":h)}}else{AlertPopup("An unexpected error occurred logging in.");$.mobile.hidePageLoadingMsg()}})}function Disconnect(){setCookie("RememberMe",0,10)}function LogOutUser(){ForceLogin=(!mobile_app);SugarQuery("logout",'[{"session":"'+SugarSessionId+'"}]',function(){AppReload()})}function GetBeansList(k,o,h,c,n){var p,i=k.length;if(c!==undefined&&c!==""){$("#"+o).append('<li data-role="list-divider" data-theme="a">'+c+"</li>")}for(p=0;p<i;p++){var m=k[p],g=$("<li"+(h?' data-icon="false"':"")+"/>");if(Beans[m.module]!==undefined){var j=m.name,a=createLink(m.module,m.id);if(h){a.css({"font-size":"12px"})}a.addClass(m.module+"SIcon");a.css({"padding-left":"20px"});a.append(j);g.append(a);$("#"+o).append(g)}}if(n===undefined||n===true){$("#"+o).listview("refresh")}}function GetBeansListIds(g,f){var c,a=g.length,e=[];for(c=0;c<a;c++){var h=g[c];if(h.module===f){e.push(h.id)}}return e}function Remove1FromList(d,b,f){var e,a=d.length;for(e=0;e<a;e++){if(d[e].id===f){d.splice(e,1);break}}}function SaveList(d,b){var e="a",f,a=d.length;for(f=0;f<a;f++){e+="@@"+d[f].id+"@@"+d[f].module+"@@"+d[f].name}localStorage.setItem(b,e)}function LoadList(e){var d=localStorage.getItem(e);var f=[];if(d!==null&&d!==""&&d!=="a"){d=d.split("@@");var c,a=(d.length-1)/3;for(c=0;c<a;c++){f[c]={id:d[3*c+1],module:d[3*c+2],name:d[3*c+3]}}}return f}function PushViewed(b,c,a){Remove1FromLastviewed(b,c);LastViewed.unshift({module:b,id:c,name:a});if(LastViewed.length>10){LastViewed.pop()}SaveLastviewed()}function GetLastViewedList(){$.mobile.showPageLoadingMsg();$("#LastViewedListDiv li").remove();GetBeansList(LastViewed,"LastViewedListDiv",false,"",true);$.mobile.hidePageLoadingMsg()}function SaveLastviewed(){SaveList(LastViewed,"LastViewed");$("#LastViewedPanelDiv li").remove();GetBeansList(LastViewed,"LastViewedPanelDiv",true,sugar_app_strings.LBL_LAST_VIEWED,true);$("#HomePanel").trigger("updatelayout")}function Remove1FromLastviewed(a,b){Remove1FromList(LastViewed,a,b)}function RemoveFromLastviewed(a,b){Remove1FromLastviewed(a,b);SaveLastviewed()}$("#GSListPage").live("pagecreate",function(){$("#GSPageTitle").text(RES_SEARCH_LABEL)});$("#GlobalSearch").live("pagecreate",function(){$("#GlobalSearchTitle").text(RES_SEARCH_LABEL);$("#GSSubmit").text(sugar_app_strings.LBL_SEARCH_BUTTON_LABEL);$("#GSSubmit").addClass("ui-disabled");$("#GSSearchText").bind("keyup",function(a,b){if($("#GSSearchText").val().length<2){$("#GSSubmit").addClass("ui-disabled")}else{$("#GSSubmit").removeClass("ui-disabled")}})});QCRM.GSBeans=[];QCRM.updateBeans=function(){var a=["Accounts","Contacts","Leads","Opportunities","Cases","Project"];QCRM.GSBeans=[];if(sugar_version>"6.5"){a.push("Tasks")}$.each(a,function(b,c){if(Beans[c]!==undefined&&Beans[c].Enabled()){QCRM.GSBeans.push(c)}});$.each(QCRM.beans,function(b,d){var c=Beans[d];if(c!==undefined&&c.Enabled()){ComputeFieldsToUpdate(d)}});if(typeof OLUpdateBean==="function"){$.each(QCRM.beans,function(b,c){if(Beans[c]!==undefined&&Beans[c].Enabled()){OLUpdateBean(c)}})}if(typeof CustomUpdateBean==="function"){$.each(QCRM.beans,function(b,c){if(Beans[c]!==undefined&&Beans[c].Enabled()){CustomUpdateBean(c)}})}};function GlobalSearch(b,d,f,a,c){var e=[],g="%"+$("#"+b).val()+"%";if(g.length<2||QCRM.GSBeans.length===0){return}if(f!=""){$.mobile.changePage("#"+f)}$.mobile.showPageLoadingMsg();$("#"+d+" li").remove();QCRM.search_by_module(QCRM.GSBeans,g,0,a,function(o){if(o&&o.entry_list!==undefined){var i,j=o.entry_list.length;for(i=0;i<j;i++){var h=o.entry_list[i],k=h.records.length,n;for(n=0;n<k;n++){e.push({module:h.name,id:h.records[n].id.value,name:h.records[n].name.value})}}GetBeansList(e,d,c)}$.mobile.hidePageLoadingMsg()})}var LastModified=[],tmpLastModified=[],cronLastModifiedId=false;function GetAllModulesList(){$.mobile.showPageLoadingMsg();$("#AllModulesListDiv li").remove();SearchPages=SearchPages.sort(function(e,d){return sugar_app_list_strings.moduleList[e]<sugar_app_list_strings.moduleList[d]?-1:1});var c,a=SearchPages.length;for(c=0;c<a;c++){var k=SearchPages[c];if(Beans[k].access!=="none"){var h=$("<li data-icon='plus' data-split-theme='d'/>"),j=sugar_app_list_strings.moduleList[Beans[k].name],g=$("<a/>",{href:"#"+Beans[k].name+"Search"});g.addClass(Beans[k].name+"SIcon");g.css({"padding-left":"20px"});g.append(j);h.append(g);var i=$("<a/>",{href:"#"});i.click({page:SearchPages[c]},function(b){Beans[b.data.page].Create()});h.append(i);$("#AllModulesListDiv").append(h)}}$.mobile.hidePageLoadingMsg()}function LogCall(d,g,e){var b="";for(var f in Beans.Calls.Links){if(Beans.Calls.Links[f].module===d){b=f;break}}}function initOptionsForm(){$("#OptGeneral").text(RES_OPT_GENERAL);$("#OptHome").text(RES_HOME_LABEL);$("#SortOrder").text(RES_SORTORDER);$("#FilterOld").text(RES_FILTEROLD);$('label[for="OptRowsPerPage"]').text(RES_ROWS_PER_PAGE);$("#OptToolbarLbl").text(RES_TOOLBAR);$('label[for="OptIconsLabels"]').text(RES_SHOWLABELS);$("#OptionsConfirmBottomBtn").text(sugar_app_strings.LBL_SAVE_BUTTON_LABEL);$("#OptionsConfirmTopBtn").text(sugar_app_strings.LBL_SAVE_BUTTON_LABEL);$("#OptionsCancelBottomBtn").text(sugar_app_strings.LBL_CANCEL_BUTTON_LABEL);$("#OptionsCancelTopBtn").text(sugar_app_strings.LBL_CANCEL_BUTTON_LABEL);$("#ConfirmLogout").text("  "+RES_YES_LABEL+"  ");$("#CancelLogout").text("  "+RES_NO_LABEL+"  ");$("#OptActDiv").hide();$("#OptFilterDiv").hide();$("#OptAlertsLbl").text(RES_ALERTS);$('label[for="OptAlerts"]').text(RES_UPDATED);$("#OptHideEmptySubPLbl").text(RES_SUBPANELS);$('label[for="OptHideEmptySubP"]').text(RES_HIDEEMPTY);if(typeof k==="undefined"){var k="Disabled"}for(var m in QCRM.beans){var e=QCRM.beans[m];if(Beans[e].Enabled()){$("#OptHomeIcons").append('<input type="checkbox" name="Home'+e+'" id="Home'+e+'" data-theme="c" checked="checked"/><label for="Home'+e+'">'+sugar_app_list_strings.moduleList[e]+"</label>");var h="",u=true,v=Beans[e].OrderBy,r=$("<li/>");if(v!==""){v=v.split(" ");h=v[0];if(v.length>1){u=v[1]==="asc"}}var q=$("<div data-role='fieldcontain'/>"),p=$("<fieldset data-role='controlgroup' data-type='horizontal'/>"),b="";p.append("<legend>"+sugar_app_list_strings.moduleList[e]+"</legend>");var n="<label for='Order"+e+"field' class='select'>Field</label>",c=$("<select name='Order"+e+"field' id='Order"+e+"field' data-mini='true' data-theme='c'/>"),o=[""].concat(Beans[e].AllOrderFields().concat(["date_entered","date_modified"])),w="";for(var a in o){var s=o[a],j=display_label(e,s);j=(j===""?"&nbsp;":j);w+="<option value='"+s+"'"+(s===h?" selected='selected'":"")+">"+j+"</option>"}c.append(w);p.append(n);p.append(c);n="<label for='Order"+e+"order' class='select'>Order</label>";c=$("<select name='Order"+e+"order' id='Order"+e+"order' data-mini='true' data-theme='c'/>");c.append("<option value='asc'"+(u?" selected='selected'":"")+">asc</option><option value='desc'"+(!u?" selected='selected'":"")+">desc</option>");p.append(n);p.append(c);q.append(p);r.append(q);$("#ModulesListSort").append(r)}}if(iOS||mobile_edition!=="Pro"){$("#OptDatePickerDiv").hide()}if(!iOS){$("#EditOptions input[type=checkbox]").live("change",function(d){$("#EditOptions input[type=checkbox]").checkboxradio("refresh")})}if(!mobile_app&&mobile_edition!=="Pro"){$("#OptAlertDiv").hide()}}function SaveOptions(){var e=false;RowsPerPage=$("#OptRowsPerPage").val();Pref.HideEmptySubP=$("#OptHideEmptySubP").is(":checked");if(IconsLabels!==$("#OptIconsLabels").is(":checked")){e=true;tmpIconsLabels=$("#OptIconsLabels").is(":checked")}dbgOption=$("#OptDebug").is(":checked");var m="";for(var d in SearchPages){var a=SearchPages[d];if(Beans[a].access==="none"){continue}var b=$("#Order"+a+"field").val(),j=(b===""||b===undefined?"":(b+" "+$("#Order"+a+"order").val()));Beans[a].OrderBy=j;m+=(m===""?"{":",")+'"'+a+'":"'+j+'"'}m+=(m===""?"":"}");var l="";var h=[];var c="";var k=[];for(var d in QCRM.beans){var a=QCRM.beans[d],g=false,f=false;if(Beans[a].Enabled()){if(!$("#Home"+a).is(":checked")){g=true}if($("#Create"+a).is(":checked")){f=true}}else{if(Pref.Hidden.indexOf(a)!==-1){g=true}if(Pref.Creates.indexOf(a)!==-1){f=true}}if(g){h=h.concat(a);l+=(l===""?"":",")+a}if(f){k=k.concat(a);c+=(c===""?"":",")+a}}Pref.Hidden=h;Pref.Creates=k;updatePreferences(false);setCookie("Icons",l,365);setCookie("Creates",c,365);setCookie("ActivitiesTo",Pref.ActivitiesTo,365);setCookie("ActivitiesFrom",Pref.ActivitiesFrom,365);setCookie("OptRowsPerPage",RowsPerPage,365);setCookie("OptLogCalls",(Pref.LogCalls?1:0),365);setCookie("OptIconsLabels",($("#OptIconsLabels").is(":checked")?1:0),365);localStorage.setItem("Alerts",(Pref.Alerts?"1":"0"));localStorage.setItem("HideEmptySubP",(Pref.HideEmptySubP?"1":"0"));setCookie("OptActMyItems",(Pref.ActivitiesMine?1:0),365);setCookie("ActStatus_planned",(Pref.Activities_planned?1:0),365);setCookie("ActStatus_held",(Pref.Activities_held?1:0),365);setCookie("ActStatus_not_held",(Pref.Activities_not_held?1:0),365);setCookie("SortOrder",m,365);if(e){$("#QDialogLabel").html(RES_AVAILABLE_NEXT_LOGIN);$("#lnkQLogout").click()}else{$("#OptionsCancelBottomBtn").trigger("click")}}function defaultPreferences(){var b;LastViewed=LoadList("LastViewed");LastModified=LoadList("LastModified");b=getCookie("OptIconsLabels");if(b==="1"){IconsLabels=true}else{if(b==="0"){IconsLabels=false}}tmpIconsLabels=IconsLabels;b=getCookie("OptDatePicker");if(b==="1"){OptDatePicker=true}else{if(b==="0"){OptDatePicker=false}}tmpOptDatePicker=OptDatePicker;Pref={LogCalls:false,Alerts:mobile_app,FilterOldDate:"",FilterOld:[],HideEmptySubP:true,Hidden:[],Disabled:[],SyncModules:{},ActivitiesWhere:"",ActivitiesFrom:0,ActivitiesTo:0,Activities_planned:true,Activities_held:true,Activities_not_held:true,ActivitiesMine:false};b=getCookie("SortOrder");if(b!==null&&b!==""){b=jQuery.parseJSON(b);for(var a in b){if(Beans[a]!==undefined){Beans[a].OrderBy=b[a]}}}b=getCookie("OptRowsPerPage");if(b!==null&&b!==""){RowsPerPage=b}b=localStorage.getItem("SyncModules");if(b!==null&&b!==""){Pref.SyncModules=jQuery.parseJSON(b);$.each(QCRM.beans,function(c,d){if(Pref.SyncModules[d]===undefined){Pref.SyncModules[d]={sync:"None",max:true}}})}else{$.each(QCRM.beans,function(c,d){Pref.SyncModules[d]={sync:"Mine",max:true}});$.each(["Notes"],function(c,d){if(Pref.SyncModules[d]!==undefined&&QCRM.beans.indexOf(d)!==-1){Pref.SyncModules[d].sync="Rel"}})}b=getCookie("OffLineNb");if(b!==null&&b!==""){Pref.OffLineNb=b}b=getCookie("Icons");if(b!==null){if(b!==""){b=b.split(",");for(var a in b){if(QCRM.beans.indexOf(b[a])!==-1){Pref.Hidden=Pref.Hidden.concat(b[a])}}}}else{$.each(QCRM.beans,function(c,d){if(!Beans[d].HomeIcon){Pref.Hidden=Pref.Hidden.concat(d)}})}b=getCookie("Creates");b=localStorage.getItem("FilterOldDate");if(b!==null){Pref.FilterOldDate=b}b=localStorage.getItem("FilterOld");if(b!==null){Pref.FilterOld=[];if(b!==""){b=b.split(",");for(var a in b){if(QCRM.beans.indexOf(b[a])!==-1){Pref.FilterOld=Pref.FilterOld.concat(b[a])}}}}}function updatePreferences(a){if(a){ShowHideToolbarLabels()}$.each(QCRM.beans,function(b,c){if(Pref.Hidden.indexOf(c)===-1&&(!QCRM.OffLine||Pref.SyncModules[c].sync!=="None")){$("#Icon"+c).show()}else{$("#Icon"+c).hide()}})}function display_label(c,d){var a=sugar_mod_fields[c];if(a[d]===undefined){return d}if((a[d].type==="boolean")||(a[d].type==="bool")){return""}var b=a[d].label;if(sugar_mod_strings[c][b]===undefined||sugar_mod_strings[c][b]===""||sugar_mod_strings[c][b]===null){return b}return sugar_mod_strings[c][b]}function display_value(a,n,o){if(sugar_mod_fields[a]===undefined){return""}else{if(sugar_mod_fields[a][n]===undefined){return o}}var c=sugar_mod_fields[a][n];switch(c.type){case"name":case"varchar":return o;case"text":return o.replace(/\\n/g,"<br>").replace(/\n/g,"<br>").replace(/\\r/g,"").replace(/\r/g,"");case"enum":var j=sugar_app_list_strings[c.options][o];return(j===undefined?o:j);case"multienum":if(o.length<=2){return""}var g=o.substr(1,o.length-2).replace(/\^,\^/g,"%").replace(/\^\^/g,"%").split("%"),k="<ul>",h=g.length,f;for(f=0;f<h;f++){var d;d=sugar_app_list_strings[c.options][g[f]];k+="<li>"+(d===undefined?g[f]:d)+"</li>"}return k+"</ul>";case"date":if(!o||o.length<10){return""}return jQuery.mobiscroll.formatDate(date_format,fromDBDate(o));case"datetime":if(!o||o.length<14){return""}return jQuery.mobiscroll.formatDate(datetime_format,fromDBDateTime(o));case"currency":if(o===""){o="0"}return parseFloat(o).toFixed(2);case"float":case"decimal":if(o===""){return""}else{return parseFloat(o).toString()}case"bool":case"boolean":var l=sugar_mod_strings[a][sugar_mod_fields[a][n].label]+"&nbsp;";return l+'<input type="checkbox" disabled="disabled" '+((o===1||o==="1")?'checked="checked"':"")+" />";case"url":o=o.trim();if(o===""){return""}var m=o.substring(0,4)!=="http"?("http://"+o):o;return(m==="http://")?"":('<a href="'+m+'" rel="external" target="_blank" style="text-decoration:none;color:#444;" >'+m+"</a>");case"email":o=o.trim();if(o===""){return""}return'<a href="mailto:'+o+'" rel="external" target="_blank" style="text-decoration:none;color:#444;" >'+o+"</a>";default:break}return o}function display_default(a,c){if(sugar_mod_fields[a]===undefined){return""}else{if(sugar_mod_fields[a][c]===undefined){return""}else{if(c=="assigned_user_id"){return""}}}var b=sugar_mod_fields[a][c];return(b.def===null?"":b.def)}function display_address(q,a,e,l){var r=q[e+"_address_street"].value,o=q[e+"_address_city"].value,p=q[e+"_address_state"].value,m=q[e+"_address_postalcode"].value,b=display_value(a,e+"_address_country",q[e+"_address_country"].value);if(r!==""||o!==""||p!==""||m!==""||b!==""){var n=Addresses_Template.replace("$street",r).replace("$postalcode",m).replace("$state",p).replace("$city",o).replace("$country",b).replace(/\\r/g,"").replace(/\\n/g,"<br/>").replace(/\n/g,"<br/>");var i="#Map"+a,k=$("<li id='"+a+e+"'/>"),g="<h4>"+n+"</h4>",j=r+"%20"+o+"%20"+(p!==""?(p+"%20"):"")+m;j=j.replace(/\n/g,"%20").replace(/&#039;/g,"'");if(mobile_app&&!iOS){var h=$("<a/>",{href:i,"data-rel":"popup","data-position-to":"window"});h.click({field:a+e,address:j,module:a},function(c){OpenMap(c.data.field,c.data.module,c.data.address)})}else{var h="http://maps.google.com/?q="+j+"&t=m&z=13&iwloc=near&output=html";h=$("<a/>",{href:h,rel:"external",target:"_blank",style:"text-decoration:none;color:#444;"})}h.append("<p><br>"+sugar_mod_strings[a]["LBL_"+e.toUpperCase()+"_ADDRESS"]+"</p>");h.append(g);k.append(h);$(l).append(k)}}function init_picker(a,b,c){$(function(){var d=new Date();$(a).mobiscroll({preset:b,minDate:new Date(d.getFullYear()-80,0,1),maxDate:new Date(d.getFullYear()+20,11,31),theme:"jqm",display:"modal",lang:default_language.substr(0,2),mode:"clickpick"});var e=c;if(c===false){e=new Date();if(b==="datetime"){e.setMinutes(15*Math.round(e.getMinutes()/15))}}if(c!==""){$(a).mobiscroll("setDate",e,(c!==false))}if(c===false){$(a).val("")}})}function set_enum_val(a,c,b){$(a).val(b);$(a+" option").attr("selected",false);if(b===""){b="EMPTY"}$(a+" option[value='"+b+"']").attr("selected","selected");$(a).selectmenu("refresh")}function set_bool_val(a,c,b){$(a+"0").attr("checked",b?false:"checked").checkboxradio("refresh");$(a+"1").attr("checked",b?"checked":false).checkboxradio("refresh")}function toDBFormField(a,c,d){var b=sugar_mod_fields[a][c];if(b!==undefined){if(b.type==="datetime"){if(OptDatePicker){d=toDBDateTime(d)}else{d=toDBDateTimeString(d)}}else{if(b.type==="date"){if(OptDatePicker){d=toDBDate(d)}else{d=toDBDateString(d)}}}}return d}function getRelatedList(d,h){var e=Beans[d].CurrentId,c=Beans[d].Links[h].module,j=(Beans[c]===undefined?SimpleBeans[c]:Beans[c]),i="#"+d+"DetailsPage"+h+"ListUl";if(j.Enabled()){$(i+" li").remove();var k=((mobile_edition==="Pro")&&(Beans[c]!==undefined&&Beans[c].access==="edit")&&Beans[d].Links[h].create),l=$("<li "+(k?"data-icon='plus'":"data-role='list-divider'")+" data-theme='b'/>");var b=sugar_app_list_strings.moduleList[c];if(Beans[d].CustomLinks&&Beans[d].CustomLinks[h]&&Beans[d].CustomLinks[h].title!==undefined){var f=Beans[d].CustomLinks[h].title;if(sugar_mod_strings[d][f]!==undefined){b=sugar_mod_strings[d][f]}else{if(f!==Beans[d].Links[h].module){b=f}}}if(k){var a=$("<a/>",{href:"#",click:function(){Beans[c].Create(d,h)}});a.append(b);l.append(a)}else{l.append(b)}var g=j.DisplaySubpanelFilter();if(Beans[c]!==undefined&&Pref.FilterOldDate!==""&&Pref.FilterOld.indexOf(c)!==-1){g+=(g===""?"":" AND ")+"date_entered>'"+Pref.FilterOldDate+"'"}QCRM.get_relationships(d,c,e,h,g,j.ListFieldsToSelect(),function(u){if(u){if(u&&u.entry_list!=undefined){if(u.entry_list.length>0){$(i).append(l);var r=0,p=u.entry_list.length,o=(d==="Accounts"?"Accounts":""),s=(d==="Accounts"?Beans.Accounts.CurrentId:"");for(r=0;r<p;r++){var t=u.entry_list[r],n=t.module_name,m;if(Beans[n]!==undefined){var q=AddLinkWithIcon(n,t.id,"",t.name_value_list,d+"DetailsPage",false,d)}else{q=$("<li/>");m=SimpleBeans[n].DisplaySubpanelElt(t.name_value_list);q.append(m)}$(i).append(q)}$(i).show()}else{if(Pref.HideEmptySubP&&!k){$(i).hide()}else{$(i).append(l);if(!Pref.HideEmptySubP){u=$("<li/>");u.append("<h4>"+RES_NO_DATA+"</h4>");$(i).append(u)}$(i).show()}}}else{$(i).hide()}}$(i).listview("refresh")})}}function displayField(s,e,r,p,j){var i="",g=sugar_mod_fields[e][r],t=g.type,f=s.name_value_list[r]===undefined?"":s.name_value_list[r].value;if(t==="url"&&g.gen===1&&f===""){f=g.def}if((s.name_value_list[r]!==undefined)&&(f!=="")&&(f!==false)){if(r==="duration_hours"){i="<h4>"+s.name_value_list.duration_hours.value+"h&nbsp;"+s.name_value_list.duration_minutes.value+"m&nbsp;</h4>"}else{if(r==="duration_minutes"){}else{if(t==="url"){i=f.trim();if(i!==""){if(i==="http://"){i=""}else{i=(i.substring(0,4)!=="http"?("http://"):"")+i;if(g.gen===1){var m=i.replace(regFindField,"$2");i=i.replace(regFindField,"$1")+s.name_value_list[m].value+i.replace(regFindField,"$3")}f=i}}}else{i='<h4 style="white-space:normal;">'+display_value(e,r,f)+"</h4>"}}}}else{if(t==="html"){i="<br>"+display_default(e,r)}}if(i!==""&&i!==false){var q,o,n;if(j&&p!==""){$(p).append('<li data-role="list-divider">'+RES_MORE_INFORMATION_LABEL+"</li>")}if(r==="duration_hours"){o="<li><p><br />"+RES_DURATION_LABEL+"</p>"+i+"</li>"}else{if(r==="duration_minutes"){}}switch(t){case"relate":case"parent":var h,l;l=g.id_name;if(t==="relate"){h=g.module}else{h=s.name_value_list[g.id_type].value}if(ViewPages.indexOf(h)===-1||s.name_value_list[l]===undefined){o="<li><p><br />"+display_label(e,r)+"</p>"+i+"</li>"}else{o=$("<li/>");n="<p><br />"+display_label(e,r)+"</p><h4>"+(t==="parent"?"<img style='top:50%;margin-top:-9px;' src='"+Beans[h].icon32+"' width='16' height='16'/>&nbsp;":"")+f+"</h4>";q=$("<a/>",{href:"#","data-identity":s.name_value_list[l].value,click:function(){Beans[h].CurrentId=$(this).data("identity");if(h===e){Beans[h].ViewDetails()}else{$.mobile.changePage("#"+h+"DetailsPage")}}});q.append(n);o.append(q)}break;case"url":o=$("<li/>");n="<h4>"+f+"</h4>";q=CreateExtLink(i);q.append("<p><br />"+display_label(e,r)+"</p>");q.append(n);o.append(q);break;case"file":q=ServerAddress+"index.php?entryPoint=download&id="+Beans[e].CurrentId+"&type="+e;n="<h4>"+s.name_value_list.filename.value+"</h4>";q=CreateExtLink(q,true);o=$("<li/>");q.append('<img class="ui-li-icon ui-li-thumb" alt="Attachment" src="images/attachment.gif">');q.append(n);o.append(q);break;case"email":o=$("<li/>");n="<h4>"+f+"</h4>";q=$("<a/>",{href:"mailto:"+f,rel:"external",style:"text-decoration:none;color:#444;"});q.append("<p><br />"+display_label(e,r)+"</p>");q.append(n);o.append(q);break;case"phone":n="";if(r.indexOf("mobile")!==-1){n=" data-icon='chat' data-split-theme='d'"}o=$("<li"+n+"/>");var k=cleanup_phone(f);n="<h4>"+f+"</h4>";q=$("<a/>",{href:"tel:"+k,rel:"external",style:"text-decoration:none;color:#444;",click:function(){LogCall(e,Beans[e].CurrentId);return true}});q.append("<p><br />"+display_label(e,r)+"</p>");q.append(n);o.append(q);if(r.indexOf("mobile")!==-1){o.append($("<a/>",{href:"sms:"+k,rel:"external",title:"SMS",style:"text-decoration:none;color:#444;"}))}break;default:o="<li><p><br />"+display_label(e,r)+"</p>"+i+"</li>";break}if(p===""){return o}else{$(p).append(o);return true}}else{return false}}function displayCustom(j,c,b,h,k){var f=(k===undefined?true:k),d=false;k=f;for(var i in b){if(b[i].substring(0,4)==="$ADD"){var g=b[i].substring(4);display_address(j.name_value_list,c,g,h);continue}var e=displayField(j,c,b[i],h,f);if(e&&!d){d=true}f=k&&!d}}function createLink(a,b){return $("<a/>",{href:"#","data-identity":b,click:function(){Beans[a].CurrentId=$(this).data("identity");$.mobile.changePage("#"+a+"DetailsPage")}})}function AddLinkWithIcon(e,c,q,g,l,j,h){l="#Phone"+l;var o=hasPhoneValues(g,e),b=(e==="Notes"&&g.filename!==undefined&&g.filename.value!=="");var n=(o?" data-icon='phone' data-split-theme='d'":(b?" data-icon='attach' data-split-theme='d'":""));var i=(q===""?Beans[e].DisplaySubpanelElt(g):q),k=$("<li"+n+"/>");var a=$("<a/>",{href:"#"});a.click({id:c,module:e},function(d){Beans[d.data.module].CurrentId=d.data.id;if(d.data.module===h){Beans[d.data.module].ViewDetails()}else{$.mobile.changePage("#"+d.data.module+"DetailsPage")}});if(j){k.addClass(e+"SIcon");k.css({"padding-left":"20px"})}a.append(i);k.append(a);if(o){var m=$("<a/>",{href:l,"data-rel":"popup"});m.click({cur:g,lnk_mod:e,page:l},function(d){OpenPhoneList(d.data.cur,d.data.lnk_mod,d.data.page,getFromTemplate(d.data.lnk_mod,d.data.cur,Beans[d.data.lnk_mod].TitleTpl),(d.data.lnk_mod!=="Calls"))});k.append(m)}else{if(b){var p=ServerAddress+"index.php?entryPoint=download&id="+c+"&type=Notes";k.append(CreateExtLink(p,true))}}return k}function GetActivitiesList(b){AlertPopup(RES_UNAVAILABLE)}function SugarCrmDelete(a,b){AlertPopup(RES_UNAVAILABLE)}function setCookie(a,d,b){if(mobile_app){localStorage.setItem(a,d);return}var e=new Date();e.setDate(e.getDate()+b);var c=escape(d)+((b===null)?"":"; expires="+e.toUTCString());document.cookie=a+"="+c}function getCookie(b){if(mobile_app){var d=localStorage.getItem(b);if(d===0){d="0"}else{if(d===1){d="1"}}return d}var c,a,f,e=document.cookie.split(";");for(c=0;c<e.length;c++){a=e[c].substr(0,e[c].indexOf("="));f=e[c].substr(e[c].indexOf("=")+1);a=a.replace(/^\s+|\s+$/g,"");if(a==b){return unescape(f)}}return""}(function(i){var n=function(c,a){var f,m,d,e,b;d=c&2147483648;e=a&2147483648;f=c&1073741824;m=a&1073741824;b=(c&1073741823)+(a&1073741823);if(f&m){return b^2147483648^d^e}return f|m?b&1073741824?b^3221225472^d^e:b^1073741824^d^e:b^d^e},h=function(c,a,f,m,d,e,b){c=n(c,n(n(a&f|~a&m,d),b));return n(c<<e|c>>>32-e,a)},l=function(c,a,f,m,d,e,b){c=n(c,n(n(a&m|f&~m,d),b));return n(c<<e|c>>>32-e,a)},j=function(c,a,f,m,d,e,b){c=n(c,n(n(a^f^m,d),b));return n(c<<e|c>>>32-e,a)},k=function(c,a,f,m,d,e,b){c=n(c,n(n(f^(a|~m),d),b));return n(c<<e|c>>>32-e,a)},g=function(b){var a="",c="",d;for(d=0;d<=3;d++){c=b>>>d*8&255;c="0"+c.toString(16);a+=c.substr(c.length-2,2)}return a};i.extend({md5:function(t){var r=[],c,d,a,b,s,m,f,e;r=t;r=r.replace(/\x0d\x0a/g,"\n");t="";for(c=0;c<r.length;c++){d=r.charCodeAt(c);if(d<128){t+=String.fromCharCode(d)}else{if(d>127&&d<2048){t+=String.fromCharCode(d>>6|192)}else{t+=String.fromCharCode(d>>12|224);t+=String.fromCharCode(d>>6&63|128)}t+=String.fromCharCode(d&63|128)}}r=t=t;t=r.length;c=t+8;d=((c-c%64)/64+1)*16;a=Array(d-1);for(s=b=0;s<t;){c=(s-s%4)/4;b=s%4*8;a[c]|=r.charCodeAt(s)<<b;s++}c=(s-s%4)/4;b=s%4*8;a[c]|=128<<b;a[d-2]=t<<3;a[d-1]=t>>>29;r=a;s=1732584193;m=4023233417;f=2562383102;e=271733878;for(t=0;t<r.length;t+=16){c=s;d=m;a=f;b=e;s=h(s,m,f,e,r[t+0],7,3614090360);e=h(e,s,m,f,r[t+1],12,3905402710);f=h(f,e,s,m,r[t+2],17,606105819);m=h(m,f,e,s,r[t+3],22,3250441966);s=h(s,m,f,e,r[t+4],7,4118548399);e=h(e,s,m,f,r[t+5],12,1200080426);f=h(f,e,s,m,r[t+6],17,2821735955);m=h(m,f,e,s,r[t+7],22,4249261313);s=h(s,m,f,e,r[t+8],7,1770035416);e=h(e,s,m,f,r[t+9],12,2336552879);f=h(f,e,s,m,r[t+10],17,4294925233);m=h(m,f,e,s,r[t+11],22,2304563134);s=h(s,m,f,e,r[t+12],7,1804603682);e=h(e,s,m,f,r[t+13],12,4254626195);f=h(f,e,s,m,r[t+14],17,2792965006);m=h(m,f,e,s,r[t+15],22,1236535329);s=l(s,m,f,e,r[t+1],5,4129170786);e=l(e,s,m,f,r[t+6],9,3225465664);f=l(f,e,s,m,r[t+11],14,643717713);m=l(m,f,e,s,r[t+0],20,3921069994);s=l(s,m,f,e,r[t+5],5,3593408605);e=l(e,s,m,f,r[t+10],9,38016083);f=l(f,e,s,m,r[t+15],14,3634488961);m=l(m,f,e,s,r[t+4],20,3889429448);s=l(s,m,f,e,r[t+9],5,568446438);e=l(e,s,m,f,r[t+14],9,3275163606);f=l(f,e,s,m,r[t+3],14,4107603335);m=l(m,f,e,s,r[t+8],20,1163531501);s=l(s,m,f,e,r[t+13],5,2850285829);e=l(e,s,m,f,r[t+2],9,4243563512);f=l(f,e,s,m,r[t+7],14,1735328473);m=l(m,f,e,s,r[t+12],20,2368359562);s=j(s,m,f,e,r[t+5],4,4294588738);e=j(e,s,m,f,r[t+8],11,2272392833);f=j(f,e,s,m,r[t+11],16,1839030562);m=j(m,f,e,s,r[t+14],23,4259657740);s=j(s,m,f,e,r[t+1],4,2763975236);e=j(e,s,m,f,r[t+4],11,1272893353);f=j(f,e,s,m,r[t+7],16,4139469664);m=j(m,f,e,s,r[t+10],23,3200236656);s=j(s,m,f,e,r[t+13],4,681279174);e=j(e,s,m,f,r[t+0],11,3936430074);f=j(f,e,s,m,r[t+3],16,3572445317);m=j(m,f,e,s,r[t+6],23,76029189);s=j(s,m,f,e,r[t+9],4,3654602809);e=j(e,s,m,f,r[t+12],11,3873151461);f=j(f,e,s,m,r[t+15],16,530742520);m=j(m,f,e,s,r[t+2],23,3299628645);s=k(s,m,f,e,r[t+0],6,4096336452);e=k(e,s,m,f,r[t+7],10,1126891415);f=k(f,e,s,m,r[t+14],15,2878612391);m=k(m,f,e,s,r[t+5],21,4237533241);s=k(s,m,f,e,r[t+12],6,1700485571);e=k(e,s,m,f,r[t+3],10,2399980690);f=k(f,e,s,m,r[t+10],15,4293915773);m=k(m,f,e,s,r[t+1],21,2240044497);s=k(s,m,f,e,r[t+8],6,1873313359);e=k(e,s,m,f,r[t+15],10,4264355552);f=k(f,e,s,m,r[t+6],15,2734768916);m=k(m,f,e,s,r[t+13],21,1309151649);s=k(s,m,f,e,r[t+4],6,4149444226);e=k(e,s,m,f,r[t+11],10,3174756917);f=k(f,e,s,m,r[t+2],15,718787259);m=k(m,f,e,s,r[t+9],21,3951481745);s=n(s,c);m=n(m,d);f=n(f,a);e=n(e,b)}return(g(s)+g(m)+g(f)+g(e)).toLowerCase()}})})(jQuery);function getFromTemplate(f,d,j){var b=j,c=b.match(/\{\w+\}/gi);for(var e in c){var g=c[e],h="";g=g.substr(1,g.length-2);if(d[g]!==undefined&&d[g].value!==undefined){h=display_value(f,g,d[g].value)}b=b.replace(c[e],h)}return b}function SugarBean(a,b,c){if(c===undefined){c=false}this.Person=false;this.Fields=[];this.name=a;this.table=b;this.Predefined=[];this.HomeIcon=true;this.LastViewed=true;this.CurrentId="";this.CurrentName="";this.CurrentData={};this.CurrentParentId="";this.CurrentParentType="";this.CurrentParentName="";this.CurrentOffset=0;this.PrevOffset=0;this.NextOffset=0;this.CurrentSearch=false;this.CurrentSearchFields=false;this.SearchName=b+".name";this.SearchFields=[];this.OrderBy="";this.TitleTpl="{name}";this.ListFields=["name"];this.ListViewTpl="<h4>{name}</h4>";this.TitleFields=["name"];this.AdditionalFields=[];this.PhoneFields=[];this.EditExcluded=[];this.Links={};this.CustomLinks=false;this.AddBtn=false;this.icon=function(){if(QCRM.OffLine||c=="none"){return"images/icon_"+(c===false?a:"custom")}else{return ServerAddress+(c?"custom/":"")+"themes/default/images/icon_"+a}};this.icon32=this.icon()+"_32.gif";this.icon48=this.icon()+".gif";this.access=((mobile_edition==="Pro")?(typeof sugar_mod==="undefined"?"edit":"none"):"view");this.acl={list:true,view:true,edit:true,del:true};this.Enabled=function(){var e=this.name;return(QCRM.beans.indexOf(e)!==-1&&this.access!=="none"&&(!QCRM.OffLine||Pref.SyncModules[e].sync!=="None")&&Pref.Disabled.indexOf(e)===-1)};this.toUpdate=false;this.toUpdateFields={};this.link_name_to_fields_relate="";var d=this;this.CreateHook=function(){};this.StoreFieldsSaved=[];this.StoreFields=function(l,g){var e;if(this.StoreFieldsSaved.length>0){e=this.StoreFieldsSaved}else{var m=["assigned_user_id","assigned_user_name","date_entered","date_modified"];e=this.AllFields().concat(this.RelateFields(true));for(var j in m){if(e.indexOf(m[j])===-1){e.push(m[j])}}this.StoreFieldsSaved=e}this.CurrentData={};for(var h in e){var k=e[h];if(l[k]){this.CurrentData[k]={name:k,value:l[k].value}}}this.CurrentName=g};this.AllFieldsSaved=[];this.AllFields=function(){if(this.AllFieldsSaved.length>0){return this.AllFieldsSaved}var g=this.TitleFields.concat(this.Fields),e;if(this.Addresses!==undefined){for(var k in d.Addresses){var i=d.Addresses[k];for(var j in AddFields){g.push(i+"_address_"+AddFields[j])}}}e=this.AdditionalFields.concat(this.SearchFields);for(var k in e){var h=e[k];if(h.substring(0,4)==="$ADD"){var i=h.substring(4);for(var j in AddFields){g.push(i+"_address_"+AddFields[j])}}else{if(g.indexOf(h)===-1){g.push(h)}}}this.AllFieldsSaved=g;return g};this.AllOrderFields=function(){var e=this.AllFields(),f=[];for(var h in e){if(sugar_mod_fields[this.name][e[h]]===undefined){continue}var g=sugar_mod_fields[this.name][e[h]].type;if(g!=="relate"&&g!=="email"&&g!=="bool"&&g!=="parent"){f.push(e[h])}}return f};this.HasAddress=function(){if(this.Addresses!==undefined&&this.Addresses[0]!==undefined){return true}for(var g in this.AdditionalFields){var e=this.AdditionalFields[g];if(e.substring(0,4)==="$ADD"){return true}}return false};this.RelateFields=function(h){var k,l,e=this.AllFields().slice(0);if(h){if(this.DefaultRelate){k=this.DefaultRelate.field;if(e.indexOf(k)===-1){e.push(k)}}if(this.DefaultParent){k=this.DefaultParent.field;if(e.indexOf(k)===-1){e.push(k)}}}var g=[];for(var j in e){k=e[j];l=sugar_mod_fields[this.name][k];if(l===undefined){}else{if(l.type==="relate"){if(l.id_name!==undefined&&l.id_name!==k){g.push(l.id_name)}}else{if(l.type==="parent"){g.push(l.id_name);g.push(l.id_type)}}}}return g};this.ListFieldsToSelect=function(){return'["'+this.ListFields.concat(["id"]).join('","')+'"]'};this.DisplaySubpanelElt=function(e){return getFromTemplate(this.name,e,this.ListViewTpl)};this.DisplaySubpanelFilter=function(e){return""};this.ViewDetailsHook=function(e){};this.ViewDetailsHdrHook=function(e){};this.ViewDetailsFtrHook=function(e){};this.CustomCheck=function(e){return""};this.ViewDetails=function(){function e(g,f,h){if(g==="deleted"){AlertPopup(sugar_app_strings.ERROR_NO_RECORD)}else{if(g==="Access Denied"){AlertPopup(RES_ACCESS_DENIED_MSG)}else{AlertPopup(RES_NO_DATA)}}RemoveFromLastviewed(f,h)}if(!init_done){MobileInit();return}$.mobile.showPageLoadingMsg();$("#"+this.name+"DetailsList li").remove();$("#"+this.name+"NameH1").html(sugar_app_list_strings.moduleListSingular[this.name]);QCRM.get_entry(this.name,this.CurrentId,function(h){if(h){if(h.name!==undefined){e(h.name,d.name,h.id,d.CurrentId);return}else{if(h.entry_list!==undefined&&h.entry_list[0]!==undefined){h=h.entry_list[0];edit_data=h.name_value_list;edit_data.module=d.name;if(edit_data[1]!==undefined&&edit_data[1].name!==undefined){e(edit_data[1].name,d.name,h.id,d.CurrentId);return}var j=getFromTemplate(d.name,edit_data,d.TitleTpl);d.StoreFields(edit_data,j);$("#"+d.name+"NameH1").html(j);if(d.LastViewed){PushViewed(d.name,d.CurrentId,j)}d.ViewDetailsHook(edit_data);d.ViewDetailsHdrHook(edit_data);var f="#"+d.name+"DetailsList";$(f).append('<li data-role="list-divider">'+RES_OVERVIEW_LABEL+"</li>");if(typeof d.ViewDetailsCustom==="function"){d.ViewDetailsCustom(edit_data,f)}else{d.DisplayStd(h);if(d.Addresses!==undefined&&d.Addresses[0]!==undefined){display_address(edit_data,d.name,d.Addresses[0],f)}}d.ViewDetailsFtrHook(edit_data);$(f).listview("refresh");var i=d.CustomLinks||d.Links;for(var k in i){var g=(d.CustomLinks&&d.CustomLinks[0]!==undefined)?i[k]:k;getRelatedList(d.name,g)}}}}});$.mobile.hidePageLoadingMsg()};this.DisplayStd=function(e){displayCustom(e,this.name,this.Fields,"#"+this.name+"DetailsList",false)};this.CheckEdit=function(e){return this.access==="edit"};this.Edit=function(f,g){var e=(this.CurrentId==="");if(mobile_edition==="Pro"){}else{AlertPopup(RES_UNAVAILABLE)}};this.Create=function(e,f){if(e){this.CurrentParentType=e;this.CurrentParentId=Beans[e].CurrentId;this.CurrentParentName=Beans[e].CurrentName}else{this.CurrentParentType="";this.CurrentParentId="";this.CurrentParentName=""}this.CurrentId="";this.CurrentName="";return this.Edit(e,f)};this.DefaultRelate=false;this.DefaultParent=false;this.CustomValues=function(f,e){return[]}}SugarBean.prototype.GetList=function(b){if(!init_done){MobileInit();return}var c="",d=this.name,e=this;SaveMyItems(d,$("#"+d+"MyItems").is(":checked"));c=get_where(d,this.SearchFields);if(c!==this.CurrentSearch){b=0;this.NextOffset=0;this.PrevOffset=0;this.CurrentOffset=0}this.CurrentSearch=c;$.mobile.showPageLoadingMsg();$("#All"+d+"ListDiv li").remove();this.CurrentOffset=b;if(b===0){$("#"+d+"PreviousBtn").addClass("ui-disabled")}else{$("#"+d+"PreviousBtn").removeClass("ui-disabled")}QCRM.get_entry_list(d,c,this.ListFieldsToSelect(),b,RowsPerPage,this.OrderBy,function(m){if(m){if(m!==undefined&&m.entry_list!==undefined){if(m.result_count===0){}else{if(m.next_offset===0){e.CurrentOffset=0}}if(m.next_offset===0||m.result_count===0){AlertPopup(RES_NO_MORE_RECORDS)}else{var j=sugar_app_list_strings.moduleList[e.name];if(m.total_count!==undefined){var l=1+e.CurrentOffset;var k=e.CurrentOffset+m.result_count;j+=" ("+l.toString()+"-"+k.toString()+"/"+m.total_count.toString()+")";if(m.next_offset>=m.total_count){$("#"+e.name+"NextBtn").addClass("ui-disabled")}else{$("#"+e.name+"NextBtn").removeClass("ui-disabled")}}$("#"+e.name+"ListPageTitle").text(j);var a=0;for(a=0;a<m.entry_list.length;a++){var i=m.entry_list[a],g=i.module_name;var h=AddLinkWithIcon(g,i.id,"",i.name_value_list,e.name+"ListPage",false,"");$("#All"+g+"ListDiv").append(h)}$("#All"+g+"ListDiv").listview("refresh");e.NextOffset=m.next_offset;e.PrevOffset=b-RowsPerPage;if(e.PrevOffset<0){e.PrevOffset=0}}}}$.mobile.hidePageLoadingMsg()})};function SugarSimpleBean(a,b,c,d){this.name=a;this.table=b;this.DefValue="";this.query=c;this.OrderBy=d===undefined?"":d;this.Fields=["name"];this.List={};this.Columns=[];this.ListFields=["name"];this.ListViewTpl="<h4>{name}</h4>";this.Enabled=function(){return true};this.ListFieldsToSelect=function(){return'["'+this.ListFields.concat(["id"]).join('","')+'"]'};this.DisplaySubpanelFilter=function(e){return""};this.DisplaySubpanelElt=function(e){return getFromTemplate(this.name,e,this.ListViewTpl)}}SugarSimpleBean.prototype.Load=function(){var a=this;QCRM.get_S_entry_list(this.name,this.query,this.Fields,0,100,this.OrderBy,function(k){if(k){if(k!=undefined&&k.entry_list!=undefined){var e=0;for(e=0;e<k.entry_list.length;e++){var j=k.entry_list[e],i="";for(var h=0;h<a.Fields.length;h++){var g=a.Fields[h];if(i!==""){i+=" "}if(j.name_value_list[g]!==undefined){i+=j.name_value_list[g].value}}a.List[j.id]=i}}}})};QCRM.SavedSearch=[];QCRM.enableBeans=function(g){PagesCreated=true;QCRM.beans=g;var a=[],e;if(typeof sugar_mod!=="undefined"){for(e in g){var c=g[e];if(Beans[c]===undefined){a.push(c);Beans[c]=new SugarBean(c,sugar_mod[c].table,sugar_mod[c].custom);if(sugar_mod[c].type==="person"){Beans[c].TitleFields=["first_name","last_name"];Beans[c].ListFields=["first_name","last_name"];Beans[c].OrderBy="last_name";Beans[c].TitleTpl="{first_name} {last_name}";Beans[c].ListViewTpl="<h4>{first_name} {last_name}</h4><p>";Beans[c].SearchName=toDBConcatName(sugar_mod[c].table+".first_name",sugar_mod[c].table+".last_name")}}Beans[c].access="edit";Beans[c].Person=(sugar_mod[c].type==="person")}for(e in g){var c=g[e];if(sugar_mod[c]&&sugar_mod[c].links!==undefined){for(var h in sugar_mod[c].links){if(Beans[c].Links[h]===undefined){var b=sugar_mod_fields[c];var i=sugar_mod[c].links[h],f=false,d;if((typeof i)!=="string"){i=sugar_mod[c].links[h].module;f=sugar_mod[c].links[h].id_name;for(d in b){if(b[d].type==="relate"){if(b[d].id_name===f){sugar_mod_fields[c][d].ass_link=h}}}}Beans[c].Links[h]={module:i,create:(a.indexOf(i)!==-1||i==="Calls"||i==="Meetings"),edit:false,id_name:f}}}}}}for(e in g.reverse()){var c=g[e];if(c!==undefined&&sugar_app_list_strings.moduleList[c]!==undefined){var j=sugar_app_list_strings.moduleList[c];if(j.length>12&&j.indexOf(" ")===-1){j='<span style="font-size: smaller;">'+j+"<span>"}$("<style type='text/css'> ."+c+"Icon{background-image:url('"+Beans[c].icon48+"');background-repeat: no-repeat;} </style>").appendTo("head");$("<style type='text/css'> ."+c+"SIcon{background-image:url('"+Beans[c].icon32+"');background-repeat: no-repeat;background-size: 16px 16px;font-size: 0.8em;background-position: 3px 50%;} </style>").appendTo("head");$("#HomeMenu").prepend('<li class="IconContainer" id="Icon'+c+'"><a href="#'+c+'Search"><div class="HomeIcon '+c+'Icon"/><div>'+j+"</div></a></li>")}}g.reverse();for(e in g){if(Beans[g[e]]!==undefined&&sugar_app_list_strings.moduleList[g[e]]!==undefined){var c=g[e];$.mobile.pageContainer.append('<div id="'+c+'Search" data-role="page" data-theme="b"><div data-role="header" data-theme="b"><h1 id="'+c+'SearchTitle"/></div><div data-role="content"><div data-role="fieldcontain"><label for="Settings'+c+'Search">'+RES_NAME_LABEL+'</label><input id="Settings'+c+'Search" type="text" /></div><div id="'+c+'DivMoreOptions" data-role="collapsible"><h3>'+RES_MORE_OPTIONS+'</h3><div name="'+c+'MyItemsOption" data-role="fieldcontain"><fieldset data-role="controlgroup" data-mini="true"><input type="checkbox" name="'+c+'MyItems" id="'+c+'MyItems" class="custom" data-theme="c" /><label for="'+c+'MyItems">'+sugar_app_strings.LBL_CURRENT_USER_FILTER+'</label></fieldset></div></div><div id="'+c+'SS" style="display: none;"></div><div style="margin:0 auto; margin-left:auto; margin-right:auto; align:center; text-align:center;"><a id="'+c+'SSearchBtn" href="#'+c+'ListPage" data-role="button" data-mini="true" data-inline="true">'+sugar_app_strings.LBL_SEARCH_BUTTON_LABEL+'</a></div></div><div data-role="footer" data-position="fixed" data-theme="a"><div data-role="navbar"><ul id="'+c+'SFtr"><li><a id="'+c+'SHomeBtn" href="#HomePage" data-role="button" data-icon="home" data-direction="reverse"/></li><li><a id="'+c+'SBackBtn" href="#" data-role="button" data-icon="back" data-rel="back"/></li><li><a id="'+c+'SAddBtn" href="#" data-role="button" data-icon="plus"></a></li><li><a id="'+c+'LastViewedBtn" href="#LastViewedListPage" data-role="button" data-icon="page" data-direction="reverse"/></li><li><a id="'+c+'AllModulesBtn" href="#AllModulesListPage" data-role="button" data-icon="grid" data-direction="reverse"/></li></ul></div></div></div>');$("#"+c+"SAddBtn").click({val:c},function(k){Beans[k.data.val].Create()});$("#"+c+"SSearchBtn").click({val:c},function(m){var l=m.data.val,k=readSearchValues(l);Beans[l].CurrentSearchFields=k;$.mobile.changePage("#"+l+"ListPage")});$.mobile.pageContainer.append('<div id="'+c+'ListPage" data-role="page" data-theme="c"><div data-role="header" data-theme="b"><h1 id="'+c+'ListPageTitle"/></div><div data-role="content"><ul id="All'+c+'ListDiv" data-role="listview" data-split-theme="c" data-filter="false" /></div><div data-role="footer" data-position="fixed" data-theme="a"><div data-role="navbar"><ul id="'+c+'LFtr"><li><a id="'+c+'PreviousBtn" href="#" data-role="button" data-icon="arrow-l"></a></li><li><a id="'+c+'ListPageHomeBtn" href="#HomePage" data-role="button" data-icon="home" data-direction="reverse" ></a></li><li><a id="'+c+'LBackBtn" href="#" data-role="button" data-icon="back" data-rel="back"/></li><li><a id="'+c+'ListPageAddBtn" href="#" data-role="button" data-icon="plus"></a></li><li><a id="'+c+'NextBtn" href="#" data-role="button" data-icon="arrow-r"></a></li></ul></div></div></div>');$("#"+c+"PreviousBtn").click({val:c},function(k){Beans[k.data.val].GetList(Beans[k.data.val].PrevOffset)});$("#"+c+"NextBtn").click({val:c},function(k){Beans[k.data.val].GetList(Beans[k.data.val].NextOffset)});$("#"+c+"ListPageAddBtn").click({val:c},function(k){Beans[k.data.val].Create()});$.mobile.pageContainer.append('<div id="'+c+'DetailsPage" data-role="page" data-theme="c"><div data-role="header" data-theme="b"><h1 id="'+c+'NameH1"/></div><div data-role="content"><div id="'+c+'DetailsHdr"></div><div><ul id="'+c+'DetailsList" data-role="listview" data-split-theme="c" data-inset="true" /></div><div id="'+c+'Links"/></div><div data-role="footer" data-position="fixed" data-theme="a"><div data-role="navbar"><ul><li><a id="'+c+'HomeBtn" href="#HomePage" data-role="button" data-icon="home" data-direction="reverse"/></li><li><a id="'+c+'BackBtn" href="#" data-role="button" data-icon="back" data-rel="back"/></li><li><a id="'+c+'SearchBtn" href="#'+c+'Search" data-role="button" data-icon="search" data-direction="reverse"/></li><li><a id="'+c+'DelBtn" href="#" data-role="button" data-icon="trash"/></li><li><a id="'+c+'EditBtn" href="#" data-role="button" data-icon="edit"/></li></ul></div></div></div>');$("#"+c+"EditBtn").click({val:c},function(k){Beans[k.data.val].Edit()});$("#"+c+"DelBtn").click({val:c},function(k){SugarCrmDelete(k.data.val,Beans[k.data.val].CurrentId)});if(Beans[c].Predefined.indexOf("Edit")==-1){$.mobile.pageContainer.append('<div id="Edit'+c+'" data-role="page" data-theme="b"><div data-role="header" data-theme="b"> <h1 id="Edit'+c+'Title"/> <a id="Edit'+c+'CancelTopBtn" href="#" data-role="button" data-rel="back" data-theme="c"/> <a id="Edit'+c+'ConfirmTopBtn" href="#" data-role="button"  data-inline="true" class="ui-btn-right" data-theme="b"/></div><div data-role="content"> <div id="Edit'+c+'Std"/><div id="Edit'+c+'Additional"/><br /> <div style="margin:0 auto; margin-left:auto; margin-right:auto; align:center; text-align:center;">  <a id="Edit'+c+'CancelBottomBtn" href="#" data-role="button" data-rel="back" data-inline="true" data-theme="c"></a>  <a id="Edit'+c+'ConfirmBottomBtn" href="#" data-role="button" data-inline="true" ></a> </div></div></div>');$("#Edit"+c+"ConfirmTopBtn").click({val:c},function(k){Beans[k.data.val].Save()});$("#Edit"+c+"ConfirmBottomBtn").click({val:c},function(k){Beans[k.data.val].Save()})}}}for(e in g){if(Beans[g[e]]!==undefined&&sugar_app_list_strings.moduleList[g[e]]!==undefined){QuickCRMAddDetailsPage(g[e]);QuickCRMAddListPage(g[e])}}$('div[data-role="page"]').each(function(k){if(this.id!=="FirstLaunch"&&this.id!=="LoginPage"&&this.id!=="QLogout"&&this.id!=="GlobalSearch"&&this.id!=="firstlaunchen"&&this.id!=="firstlaunchfr"){$(this).append('<div data-role="popup" id="Alert'+this.id+'"></div>')}})};function ComputeFieldsToUpdate(e){var j=Beans[e],k={},b=[],a=false,c=sugar_mod_fields[e];for(var h in j.Links){var d=j.Links[h].module;if(Beans[d]!==undefined&&Beans[d].Enabled()){var i;if(Beans[d].Person){i={name:h,value:["id","first_name","last_name"]}}else{i={name:h,value:["id","name"]}}b.push(i);if(Beans[e].Links[h].id_name){var g=j.Links[h].id_name,f;for(fld in c){if(c[fld].type==="relate"&&c[fld].id_name===g){f=fld;k[h]={id_name:g,id_value:f,person:Beans[d].Person};a=true;break}}}}else{if(SimpleBeans[d]!==undefined){b.push({name:h,value:["id"]})}}}Beans[e].toUpdate=a;Beans[e].toUpdateFields=k;Beans[e].link_fields=JSON.stringify(b)}Beans.Accounts=new SugarBean("Accounts","accounts");Beans.Accounts.ListFields=["name","billing_address_city","billing_address_state"];Beans.Accounts.OrderBy="name";Beans.Accounts.ListViewTpl="<h4>{name}</h4><p>{billing_address_city} {billing_address_state}</p>";Beans.Accounts.Links={contacts:{module:"Contacts",create:true,edit:false},opportunities:{module:"Opportunities",create:true,edit:false},calls:{module:"Calls",create:true,edit:false},meetings:{module:"Meetings",create:true,edit:false},tasks:{module:"Tasks",create:false,edit:false},leads:{module:"Leads",create:false,edit:false},notes:{module:"Notes",create:true,edit:false}};Beans.Contacts=new SugarBean("Contacts","contacts");Beans.Contacts.ListFields=["first_name","last_name","account_name","account_id","title"];Beans.Contacts.OrderBy="last_name";Beans.Contacts.TitleTpl="{first_name} {last_name}";Beans.Contacts.ListViewTpl="<h4>{first_name} {last_name}</h4><p>{title} {account_name}</p>";Beans.Contacts.SearchName=toDBConcatName("contacts.first_name","contacts.last_name");Beans.Contacts.Links={calls:{module:"Calls",create:true,edit:false},meetings:{module:"Meetings",create:true,edit:false},tasks:{module:"Tasks",create:true,edit:false},opportunities:{module:"Opportunities",create:true,edit:false},notes:{module:"Notes",create:true,edit:false}};Beans.Contacts.ViewDetailsFtrHook=function(a){if(a.account_id!==undefined&&a.account_id.value!==undefined){this.CurrentParentId=a.account_id.value;this.CurrentParentName=a.account_name.value;this.CurrentParentType="Accounts"}else{this.CurrentParentId="";this.CurrentParentName="";this.CurrentParentType=""}};Beans.Leads=new SugarBean("Leads","leads");Beans.Leads.ListFields=["first_name","last_name","title","account_name"];Beans.Leads.OrderBy="last_name";Beans.Leads.TitleTpl="{first_name} {last_name}";Beans.Leads.ListViewTpl="<h4>{first_name} {last_name}</h4><p>{account_name}</p>";Beans.Leads.SearchName=toDBConcatName("leads.first_name","leads.last_name");Beans.Leads.Links={calls:{module:"Calls",create:true,edit:false},meetings:{module:"Meetings",create:true,edit:false},tasks:{module:"Tasks",create:false,edit:false},notes:{module:"Notes",create:true,edit:false}};Beans.Leads.ViewDetailsHdrHook=function(d){if(d.status!==undefined&&d.status.value==="Converted"){var a=[];var b,c;if(d.contact_id!==undefined&&d.contact_id.value!==""){a.push({module:"Contacts",id:d.contact_id.value,name:getFromTemplate("Contacts",d,Beans.Contacts.TitleTpl)})}if(d.account_id!==undefined&&d.account_id.value!==""){a.push({module:"Accounts",id:d.account_id.value,name:d.account_name.value})}if(d.opportunity_id!==undefined&&d.opportunity_id.value!==""){a.push({module:"Opportunities",id:d.opportunity_id.value,name:d.opportunity_name.value})}if(a.length>0){$("#LeadsDetailsList").append('<li data-role="list-divider">'+sugar_app_list_strings.lead_status_dom.Converted+"</li>");GetBeansList(a,"LeadsDetailsList",false)}}};Beans.Opportunities=new SugarBean("Opportunities","opportunities");Beans.Opportunities.ListFields=["name","amount","account_name","currency_name","currency_symbol","sales_stage"];Beans.Opportunities.OrderBy="amount desc";Beans.Opportunities.ListViewTpl="<h4>{name}</h4><p>{account_name} {currency_symbol}{amount} {sales_stage}</p>";Beans.Opportunities.Links={contacts:{module:"Contacts",create:false,edit:false},calls:{module:"Calls",create:false,edit:false},meetings:{module:"Meetings",create:false,edit:false},tasks:{module:"Tasks",create:false,edit:false},leads:{module:"Leads",create:false,edit:false},notes:{module:"Notes",create:true,edit:false}};Beans.Calls=new SugarBean("Calls","calls");Beans.Calls.ListFields=["name","status","date_start"];Beans.Calls.OrderBy="date_start";Beans.Calls.ListViewTpl="<h4>{name}</h4><p>{status} - {date_start}</p>";Beans.Calls.Links={contacts:{module:"Contacts",create:false,edit:false},users:{module:"Users",create:false,edit:false},leads:{module:"Leads",create:false,edit:false},notes:{module:"Notes",create:true,edit:false}};Beans.Meetings=new SugarBean("Meetings","meetings");Beans.Meetings.ListFields=["name","status","date_start"];Beans.Meetings.OrderBy="date_start";Beans.Meetings.ListViewTpl="<h4>{name}</h4><p>{status} - {date_start}</p>";Beans.Meetings.Links={contacts:{module:"Contacts",create:false,edit:false},users:{module:"Users",create:false,edit:false},leads:{module:"Leads",create:false,edit:false},notes:{module:"Notes",create:true,edit:false}};Beans.Tasks=new SugarBean("Tasks","tasks");Beans.Tasks.ListFields=["name","status","date_due"];Beans.Tasks.OrderBy="date_due desc";Beans.Tasks.ListViewTpl="<h4>{name}</h4><p>{status} - {date_due}</p>";Beans.Tasks.Links={notes:{module:"Notes",create:true,edit:false}};Beans.Cases=new SugarBean("Cases","cases");Beans.Cases.ListFields=["name","status","priority"];Beans.Cases.ListViewTpl="<h4>{name}</h4><p>{status} - {priority}</p>";Beans.Cases.Links={notes:{module:"Notes",create:true,edit:false}};Beans.Cases.EditExcluded=["case_number"];Beans.Accounts.Links.cases={module:"Cases",create:true,edit:false};Beans.Project=new SugarBean("Project","project");Beans.Project.ListFields=["name","status","priority"];Beans.Project.ListViewTpl="<h4>{name}</h4><p>{status} - {priority}</p>";Beans.Project.Links={projecttask:{module:"ProjectTask",create:true,edit:false},notes:{module:"Notes",create:true,edit:false}};Beans.ProjectTask=new SugarBean("ProjectTask","project_task");Beans.ProjectTask.ListFields=["name","status","assigned_user_name"];Beans.ProjectTask.ListViewTpl="<h4>{name}</h4><p>{status} - {assigned_user_name}</p>";Beans.ProjectTask.Links={notes:{module:"Notes",create:true,edit:false}};Beans.Notes=new SugarBean("Notes","notes");Beans.Notes.Predefined=["Edit"];Beans.Notes.HomeIcon=false;Beans.Notes.LastViewed=false;Beans.Notes.DefaultRelate={field:"contact_name",id_name:"contact_id",module:"Contacts"};Beans.Notes.DefaultParent={field:"parent_name",id_name:"parent_id",module:"parent_type"};Beans.Notes.ListFields=["name","filename"];Beans.Notes.TmpFile={name:"",contents:""};Beans.Notes.CustomValues=function(c,a){var b=[];if(c.filename.value===" --- "){b.filename={field:"filename",value:""}}return b};if(mobile_edition!=="Pro"){Beans.Contacts.TitleFields=["first_name","last_name"];Beans.Leads.TitleFields=["first_name","last_name"];Beans.Accounts.Fields=["phone_office","phone_fax","website","email1","description","assigned_user_name"];Beans.Contacts.Fields=["title","account_name","email1","phone_work","phone_mobile","description","assigned_user_name"];Beans.Leads.Fields=["title","account_name","status","email1","phone_work","phone_mobile","description","assigned_user_name"];Beans.Opportunities.Fields=["amount","date_closed","sales_stage","account_name","description","assigned_user_name"];Beans.Calls.Fields=["direction","status","date_start","duration_hours","duration_minutes","description","parent_name","assigned_user_name"];Beans.Meetings.Fields=["status","date_start","duration_hours","duration_minutes","description","parent_name","assigned_user_name"];Beans.Tasks.Fields=["status","date_start","date_due","priority","description","parent_name","assigned_user_name"];Beans.Notes.Fields=["description","filename"];Beans.Accounts.Addresses=["billing","shipping"];Beans.Contacts.Addresses=["primary","alt"];Beans.Leads.Addresses=["primary","alt"];Beans.Cases.Fields=["case_number","type","status","priority","account_name","description"];Beans.Project.Fields=["status","priority","description"];Beans.ProjectTask.Fields=["status","priority","percent_complete","assigned_user_name","project_name","description"]}SimpleBeans.Users=new SugarSimpleBean("Users","users","users.status='Active'","");if(!QCRM.OffLine){SimpleBeans.Users.Fields=["first_name","last_name"];SimpleBeans.Users.OrderBy="last_name";SimpleBeans.Users.ListFields=["first_name","last_name"];SimpleBeans.Users.ListViewTpl="{first_name} {last_name}"};